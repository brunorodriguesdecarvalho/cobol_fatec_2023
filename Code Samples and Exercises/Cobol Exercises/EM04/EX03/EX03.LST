* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   1
*                                       EX03.CBL
* Options: LIST(EX03.LST) ASMLIST(EX03.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. EX03.
     3 AUTHOR. BRUNO CARVALHO.
     4 DATE-WRITTEN. 19/06/2023.
     5 DATE-COMPILED. 19-Jun-23 16:21.
     6
     7 ENVIRONMENT DIVISION.
     8 CONFIGURATION SECTION.
     9 SOURCE-COMPUTER. BRUNO-PC.
    10 OBJECT-COMPUTER. BRUNO-PC.
    11 SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    12
    13 INPUT-OUTPUT SECTION.
    14 FILE-CONTROL.
    15
    16 SELECT CADMERC ASSIGN TO DISK
    17 ORGANIZATION IS LINE SEQUENTIAL.
    18
    19 SELECT MOVMERC ASSIGN TO DISK
    20 ORGANIZATION IS LINE SEQUENTIAL.
    21
    22 SELECT ATUMERC ASSIGN TO DISK
    23 ORGANIZATION IS LINE SEQUENTIAL.
    24
    25 SELECT RELERRO ASSIGN TO DISK
    26 ORGANIZATION IS LINE SEQUENTIAL.
    27
    28 SELECT RELMERC ASSIGN TO DISK
    29 ORGANIZATION IS LINE SEQUENTIAL.
    30
    31 DATA DIVISION.
    32
    33 FILE SECTION.
    34 FD CADMERC
    35     LABEL RECORD ARE STANDARD
    36     VALUE OF FILE-ID IS "CADMERC.DAT".
    37 01 REG-CADMERC.
    38     02 CODIGO-CADMERC      PIC 9(03).
    39     02 DESCRICAO-CADMERC   PIC X(30).
    40     02 ESTOQ-MIN-CADMERC   PIC 9(03).
    41     02 QTD-ESTOQ-CADMERC   PIC 9(03).
    42     02 PRECO-UNIT-CADMERC  PIC 9(04)V9(02).
    43
    44 FD MOVMERC
    45     LABEL RECORD ARE STANDARD
    46     VALUE OF FILE-ID IS "MOVMERC.DAT".
    47 01 REG-MOVMERC.
    48     02 CODIGO-MOVMERC           PIC 9(03).
    49     02 DESCRICAO-MOVMERC        PIC X(30).
    50     02 ESTOQ-MIN-MOVMERC        PIC 9(03).
    51     02 QTD-ESTOQ-MOVMERC        PIC 9(03).
    52     02 PRECO-UNIT-MOVMERC       PIC 9(04)V9(02).
    53     02 TIPO-ATUALIZACAO-MOVMERC PIC X(01).
    54
    55 FD ATUMERC
    56     LABEL RECORD ARE STANDARD
    57     VALUE OF FILE-ID IS "ATUMERC.DAT".
* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   2
*                                       EX03.CBL
    58 01 REG-ATUMERC.
    59     02 CODIGO-ATUMERC      PIC 9(03).
    60     02 DESCRICAO-ATUMERC   PIC X(30).
    61     02 ESTOQ-MIN-ATUMERC   PIC 9(03).
    62     02 QTD-ESTOQ-ATUMERC   PIC 9(03).
    63     02 PRECO-UNIT-ATUMERC  PIC 9(04)V9(02).
    64
    65 FD RELERRO
    66    LABEL RECORD IS OMITTED.
    67 01 REL-ERRO              PIC X(80).
    68
    69 FD RELMERC
    70    LABEL RECORD IS OMITTED.
    71 01 REL-MERC              PIC X(80).
    72
    73 WORKING-STORAGE SECTION.
    74
    75 77 CH-CADMERC      PIC X(04) VALUE SPACES.
    76 77 CH-MOVMERC      PIC X(04) VALUE SPACES.
    77 77 CT-PAG-RELERRO  PIC 9(03) VALUE 0.
    78 77 CT-PAG-RELMERC  PIC 9(03) VALUE 0.
    79 77 CT-LIN-RELERRO  PIC 9(02) VALUE 41.
    80 77 CT-LIN-RELMERC  PIC 9(02) VALUE 41.
    81
    82 01 CAB-01-RELERRO.
    83     02 FILLER         PIC X(27) VALUE SPACES.
    84     02 FILLER         PIC X(24) VALUE "RELATORIO DE MERCADORIAS".
    85     02 FILLER         PIC X(15) VALUE SPACES.
    86     02 FILLER         PIC X(05) VALUE "PAG. ".
    87     02 VAR-PAG-RELERRO PIC ZZ9.
    88     02 FILLER         PIC X(06) VALUE SPACES.
    89
    90 01 CAB-02-RELERRO.
    91     02 FILLER  PIC X(30) VALUE SPACES.
    92     02 FILLER  PIC X(20) VALUE "ERROS DE ATUALIZACAO".
    93     02 FILLER  PIC X(30) VALUE SPACES.
    94
    95 01 CAB-03-RELERRO.
    96     02 FILLER PIC X(03) VALUE SPACES.
    97     02 FILLER PIC X(06) VALUE "CODIGO".
    98     02 FILLER PIC X(10) VALUE SPACES.
    99     02 FILLER PIC X(09) VALUE "DESCRICAO".
   100     02 FILLER PIC X(26) VALUE SPACES.
   101     02 FILLER PIC X(08) VALUE "MENSAGEM".
   102     02 FILLER PIC X(18) VALUE SPACES.
   103
   104 01 DETALHE-RELERRO.
   105     02 FILLER            PIC X(04) VALUE SPACES.
   106     02 CODIGO-RELERRO    PIC 999.
   107     02 FILLER            PIC X(04) VALUE SPACES.
   108     02 DESCRICAO-RELERRO PIC X(30).
   109     02 FILLER            PIC X(03) VALUE SPACES.
   110     02 MENSAGEM-RELERRO  PIC X(31).
   111     02 FILLER            PIC X(08) VALUE SPACES.
   112
   113 01 CAB-01-RELMERC.
   114     02 FILLER         PIC X(27) VALUE SPACES.
   115     02 FILLER         PIC X(24) VALUE "RELATORIO DE MERCADORIAS".
* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   3
*                                       EX03.CBL
   116     02 FILLER         PIC X(15) VALUE SPACES.
   117     02 FILLER         PIC X(05) VALUE "PAG. ".
   118     02 VAR-PAG-RELMERC   PIC ZZ9.
   119     02 FILLER         PIC X(06) VALUE SPACES.
   120
   121 01 CAB-02-RELMERC.
   122     02 FILLER PIC X(32) VALUE SPACES.
   123     02 FILLER PIC X(15) VALUE "ESTOQUE CRITICO".
   124     02 FILLER PIC X(32) VALUE SPACES.
   125
   126 01 CAB-03-RELMERC.
   127     02 FILLER PIC X(02) VALUE SPACES.
   128     02 FILLER PIC X(06) VALUE "CODIGO".
   129     02 FILLER PIC X(04) VALUE SPACES.
   130     02 FILLER PIC X(09) VALUE "DESCRICAO".
   131     02 FILLER PIC X(20) VALUE SPACES.
   132     02 FILLER PIC X(07) VALUE "ESTOQUE".
   133     02 FILLER PIC X(05) VALUE SPACES.
   134     02 FILLER PIC X(10) VALUE "QUANTIDADE".
   135     02 FILLER PIC X(06) VALUE SPACES.
   136     02 FILLER PIC X(05) VALUE "PRECO".
   137     02 FILLER PIC X(06) VALUE SPACES.
   138
   139 01 CAB-04-RELMERC.
   140     02 FILLER PIC X(42) VALUE SPACES.
   141     02 FILLER PIC X(06) VALUE "MINIMO".
   142     02 FILLER PIC X(06) VALUE SPACES.
   143     02 FILLER PIC X(07) VALUE "ESTOQUE".
   144     02 FILLER PIC X(07) VALUE SPACES.
   145     02 FILLER PIC X(08) VALUE "UNITARIO".
   146     02 FILLER PIC X(04) VALUE SPACES.
   147
   148 01 DETALHE-RELMERC.
   149     02 FILLER             PIC X(03) VALUE SPACES.
   150     02 CODIGO-RELMERC     PIC 999.
   151     02 FILLER             PIC X(02) VALUE SPACES.
   152     02 DESCRICAO-RELMERC  PIC X(30).
   153     02 FILLER             PIC X(06) VALUE SPACES.
   154     02 ESTOQ-MIN-RELMERC  PIC 999.
   155     02 FILLER             PIC X(09) VALUE SPACES.
   156     02 QTD-ESTOQ-RELMERC  PIC 999.
   157     02 FILLER             PIC X(09) VALUE SPACES.
   158     02 PRECO-UNIT-RELMERC PIC Z.Z99,99.
   159     02 FILLER             PIC X(04) VALUE SPACES.
   160
   161 PROCEDURE DIVISION.
   162
   163 PROGRAM03.
   164
   165 PERFORM INICIO.
   166 PERFORM PRINCIPAL UNTIL CH-CADMERC EQUAL CH-MOVMERC AND
   167                         CH-MOVMERC  EQUAL HIGH-VALUES.
   168 PERFORM FIM.
   169 STOP RUN.
   170
   171 INICIO.
   172        OPEN INPUT CADMERC MOVMERC OUTPUT ATUMERC RELERRO RELMERC.
   173        PERFORM LER-CADMERC.
* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   4
*                                       EX03.CBL
   174        PERFORM LER-MOVMERC.
   175
   176 LER-CADMERC.
   177        READ CADMERC AT END MOVE HIGH-VALUES TO CH-CADMERC.
   178        IF CH-CADMERC EQUAL HIGH-VALUES
   179           NEXT SENTENCE
   180        ELSE
   181           MOVE CODIGO-CADMERC TO CH-CADMERC
   182        END-IF.
   183
   184 LER-MOVMERC.
   185        READ MOVMERC AT END MOVE HIGH-VALUES TO CH-MOVMERC.
   186        IF CH-MOVMERC EQUAL HIGH-VALUES
   187           NEXT SENTENCE
   188        ELSE
   189           MOVE CODIGO-MOVMERC TO CH-MOVMERC
   190        END-IF.
   191
   192 PRINCIPAL.
   193        IF CT-LIN-RELERRO GREATER THAN 40
   194           PERFORM CABECALHO-RELERRO
   195        END-IF
   196
   197        IF CT-LIN-RELMERC GREATER THAN 40
   198           PERFORM CABECALHO-RELMERC
   199        END-IF
   200*IGUAL
   201        IF CH-CADMERC EQUAL CH-MOVMERC
   202           IF TIPO-ATUALIZACAO-MOVMERC EQUAL "A"
   203              PERFORM GRAVA-MOVMERC
   204           END-IF
   205
   206           IF TIPO-ATUALIZACAO-MOVMERC EQUAL "I"
   207              MOVE CODIGO-MOVMERC     TO CODIGO-RELERRO
   208              MOVE DESCRICAO-MOVMERC  TO DESCRICAO-RELERRO
   209              MOVE "INCLUSAO P/REG. JA EXISTENTE" TO
   210                                               MENSAGEM-RELERRO
   211              WRITE REL-ERRO FROM DETALHE-RELERRO AFTER
   212                                               ADVANCING 1 LINE
   213
   214              PERFORM GRAVA-CADMERC
   215           END-IF
   216
   217           PERFORM LER-CADMERC
   218           PERFORM LER-MOVMERC
   219        ELSE
   220*CADANT
   221           IF CH-CADMERC LESS CH-MOVMERC
   222              PERFORM GRAVA-CADMERC
   223              PERFORM LER-CADMERC
   224*CADMOV
   225           ELSE
   226              MOVE CODIGO-MOVMERC     TO CODIGO-RELERRO
   227              MOVE DESCRICAO-MOVMERC  TO DESCRICAO-RELERRO
   228
   229              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "A"
   230                 MOVE "ALTERACAO P/REG. INEXISTENTE"
   231                 TO MENSAGEM-RELERRO
* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   5
*                                       EX03.CBL
   232              END-IF
   233
   234              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "E"
   235                 MOVE "EXCLUSAO P/REG. INEXISTENTE"
   236                 TO MENSAGEM-RELERRO
   237              END-IF
   238
   239              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "I"
   240                 PERFORM GRAVA-MOVMERC
   241              ELSE
   242                 WRITE REL-ERRO FROM DETALHE-RELERRO AFTER
   243                                          ADVANCING 1 LINE
   244              END-IF
   245
   246              PERFORM LER-MOVMERC
   247           END-IF
   248        END-IF.
   249
   250 GRAVA-MOVMERC.
   251        MOVE CODIGO-MOVMERC     TO CODIGO-ATUMERC.
   252        MOVE DESCRICAO-MOVMERC  TO DESCRICAO-ATUMERC.
   253        MOVE ESTOQ-MIN-MOVMERC  TO ESTOQ-MIN-ATUMERC.
   254        MOVE QTD-ESTOQ-MOVMERC  TO QTD-ESTOQ-ATUMERC.
   255        MOVE PRECO-UNIT-MOVMERC TO PRECO-UNIT-ATUMERC.
   256        WRITE REG-ATUMERC.
   257        PERFORM CARIMBA-DETALHE-RELMERC.
   258
   259 GRAVA-CADMERC.
   260        MOVE CODIGO-CADMERC     TO CODIGO-ATUMERC.
   261        MOVE DESCRICAO-CADMERC  TO DESCRICAO-ATUMERC.
   262        MOVE ESTOQ-MIN-CADMERC  TO ESTOQ-MIN-ATUMERC.
   263        MOVE QTD-ESTOQ-CADMERC  TO QTD-ESTOQ-ATUMERC.
   264        MOVE PRECO-UNIT-CADMERC TO PRECO-UNIT-ATUMERC.
   265        WRITE REG-ATUMERC.
   266        PERFORM CARIMBA-DETALHE-RELMERC.
   267
   268 CARIMBA-DETALHE-RELMERC.
   269        IF QTD-ESTOQ-ATUMERC NOT GREATER THAN ESTOQ-MIN-ATUMERC
   270           MOVE CODIGO-ATUMERC     TO CODIGO-RELMERC
   271           MOVE DESCRICAO-ATUMERC  TO DESCRICAO-RELMERC
   272           MOVE ESTOQ-MIN-ATUMERC  TO ESTOQ-MIN-RELMERC
   273           MOVE QTD-ESTOQ-ATUMERC  TO QTD-ESTOQ-RELMERC
   274           MOVE PRECO-UNIT-ATUMERC TO PRECO-UNIT-RELMERC
   275           WRITE REL-MERC FROM DETALHE-RELMERC
   276           ADD 1 TO CT-LIN-RELMERC
   277        END-IF.
   278
   279 FIM.
   280        CLOSE CADMERC MOVMERC ATUMERC RELERRO RELMERC.
   281
   282 CABECALHO-RELERRO.
   283        ADD 1 TO CT-PAG-RELERRO.
   284        MOVE CT-PAG-RELERRO TO VAR-PAG-RELERRO.
   285        MOVE 0 TO CT-LIN-RELERRO.
   286        MOVE SPACES TO REL-ERRO.
   287        WRITE REL-ERRO AFTER ADVANCING PAGE.
   288        WRITE REL-ERRO FROM CAB-01-RELERRO
   289                               AFTER ADVANCING 1 LINE.
* Microsoft COBOL Version 4.5        L2.4 revision 002 19-Jun-23 16:21 Page   6
*                                       EX03.CBL
   290        WRITE REL-ERRO FROM CAB-02-RELERRO
   291                               AFTER ADVANCING 2 LINES.
   292        WRITE REL-ERRO FROM CAB-03-RELERRO
   293                               AFTER ADVANCING 2 LINES.
   294        MOVE SPACES TO REL-ERRO.
   295        WRITE REL-ERRO AFTER ADVANCING 1 LINE.
   296
   297 CABECALHO-RELMERC.
   298        ADD 1 TO CT-PAG-RELMERC.
   299        MOVE CT-PAG-RELMERC TO VAR-PAG-RELMERC.
   300        MOVE 0 TO CT-LIN-RELMERC.
   301        MOVE SPACES TO REL-MERC.
   302        WRITE REL-MERC AFTER ADVANCING PAGE.
   303        WRITE REL-MERC FROM CAB-01-RELMERC
   304                               AFTER ADVANCING 1 LINE.
   305        WRITE REL-MERC FROM CAB-02-RELMERC
   306                               AFTER ADVANCING 2 LINES.
   307        WRITE REL-MERC FROM CAB-03-RELMERC
   308                               AFTER ADVANCING 2 LINES.
   309        WRITE REL-MERC FROM CAB-04-RELMERC
   310                               AFTER ADVANCING 1 LINE.
   311        MOVE SPACES TO REL-MERC.
   312        WRITE REL-MERC AFTER ADVANCING 1 LINE.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2572     Code:        1561     Dictionary:        3715
