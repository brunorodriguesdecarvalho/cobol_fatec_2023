* Microsoft COBOL Version 4.5        L2.4 revision 002 05-Jun-23 19:01 Page   1
*                                       EX04.CBL
* Options: LIST(EX04.LST) ASMLIST(EX04.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. EX04.
     3 AUTHOR. BRUNO CARVALHO.
     4 INSTALLATION. BRUNO-PC.
     5 DATE-WRITTEN. 28/05/2023.
     6 DATE-COMPILED. 05-Jun-23 19:01.
     7 SECURITY. APENAS O AUTOR PODE MODIFICA-LO.
     8
     9 ENVIRONMENT DIVISION.
    10
    11 CONFIGURATION SECTION.
    12 SOURCE-COMPUTER. IBM-PC.
    13 OBJECT-COMPUTER. IBM-PC.
    14 SPECIAL-NAMES. DECIMAL-POINT IS COMMA.
    15
    16 INPUT-OUTPUT SECTION.
    17 FILE-CONTROL.
    18     SELECT CADCLI ASSIGN TO DISK
    19     ORGANIZATION IS LINE SEQUENTIAL.
    20
    21     SELECT ARQORD ASSIGN TO DISK.
    22     SELECT RELAT ASSIGN TO DISK.
    23
    24 DATA DIVISION.
    25 FILE SECTION.
    26
    27 FD CADCLI
    28     LABEL RECORD ARE STANDARD
    29     VALUE OF FILE-ID IS "CADCLI.DAT".
    30 01 REG-CLIENTE.
    31     02 CODIGO-ENT   PIC 9(03).
    32     02 CPF-ENT      PIC 9(11).
    33     02 NOME-ENT     PIC X(30).
    34     02 ESTADO-ENT   PIC X(02).
    35     02 CIDADE-ENT   PIC X(30).
    36     02 EMAIL-ENT    PIC X(30).
    37
    38 SD ARQORD.
    39 01 SORTED.
    40     02 CODIGO-SORT   PIC 9(03).
    41     02 CPF-SORT      PIC 9(11).
    42     02 NOME-SORT     PIC X(30).
    43     02 EST-SORT   PIC X(02).
    44     02 CID-SORT   PIC X(30).
    45     02 EMAIL-SORT    PIC X(30).
    46
    47 FD RELAT
    48     LABEL RECORD IS OMITTED.
    49 01 REG-REL  PIC X(72).
    50
    51 WORKING-STORAGE SECTION.
    52 77 FIM-ARQ PIC X(03) VALUE "NAO".
    53 77 CT-LIN  PIC 9(02) VALUE 20.
    54 77 CT-PAG  PIC 9(02) VALUE ZEROES.
    55 77 EST-TMP PIC X(02).
    56 77 CID-TMP PIC X(30).
    57
* Microsoft COBOL Version 4.5        L2.4 revision 002 05-Jun-23 19:01 Page   2
*                                       EX04.CBL
    58 01 CAB-01.
    59     02 FILLER  PIC X(10) VALUE SPACES.
    60     02 FILLER  PIC X(19) VALUE "RELACAO DE CLIENTES".
    61     02 FILLER  PIC X(18) VALUE " POR ESTADO/CIDADE".
    62     02 FILLER  PIC X(18) VALUE SPACES.
    63     02 FILLER  PIC X(05) VALUE "PAG.".
    64     02 VAR-PAG PIC 9(02).
    65
    66 01 CAB-02.
    67     02 FILLER  PIC X(08) VALUE "ESTADO: ".
    68     02 ESTADO-DET  PIC X(02).
    69
    70 01 CAB-03.
    71     02 FILLER      PIC X(08) VALUE "CIDADE: ".
    72     02 CIDADE-DET  PIC X(30).
    73
    74 01 CAB-04.
    75     02 FILLER  PIC X(03) VALUE "CPF".
    76     02 FILLER  PIC X(10) VALUE SPACES.
    77     02 FILLER  PIC X(04) VALUE "NOME".
    78     02 FILLER  PIC X(28) VALUE SPACES.
    79     02 FILLER  PIC X(06) VALUE "E-MAIL".
    80
    81 01 DETALHE.
    82     02 CPF-DET PIC 9(11).
    83     02 FILLER  PIC X(02) VALUE SPACES.
    84     02 NOME-DET PIC X(20).
    85     02 FILLER  PIC X(02) VALUE SPACES.
    86     02 EMAIL-DET PIC X(30).
    87
    88 PROCEDURE DIVISION.
    89
    90 PGM-EX04.
    91     SORT ARQORD
    92          ASCENDING KEY EST-SORT
    93          ASCENDING KEY CID-SORT
    94          ASCENDING KEY NOME-SORT
    95          INPUT PROCEDURE ROT-ENTRADA
    96          OUTPUT PROCEDURE ROT-SAIDA.
    97     STOP RUN.
    98
    99 ROT-ENTRADA SECTION.
   100     PERFORM INICIO-ENTRADA.
   101     PERFORM PRINCIPAL-ENTRADA UNTIL FIM-ARQ EQUAL "SIM".
   102     PERFORM FIM-ENTRADA.
   103
   104 INICIO-ENTRADA SECTION.
   105     OPEN INPUT CADCLI.
   106     PERFORM LEITURA-ENTRADA.
   107
   108 LEITURA-ENTRADA SECTION.
   109     READ CADCLI AT END MOVE "SIM" TO FIM-ARQ.
   110
   111 PRINCIPAL-ENTRADA SECTION.
   112     PERFORM SELECAO-ENTRADA.
   113     PERFORM LEITURA-ENTRADA.
   114
   115 SELECAO-ENTRADA SECTION.
* Microsoft COBOL Version 4.5        L2.4 revision 002 05-Jun-23 19:01 Page   3
*                                       EX04.CBL
   116     PERFORM GRAVACAO-ENTRADA.
   117
   118 GRAVACAO-ENTRADA SECTION.
   119     MOVE CODIGO-ENT TO CODIGO-SORT.
   120     MOVE ESTADO-ENT TO EST-SORT.
   121     MOVE CIDADE-ENT TO CID-SORT.
   122     MOVE CPF-ENT TO CPF-SORT.
   123     MOVE NOME-ENT TO NOME-SORT.
   124     MOVE EMAIL-ENT TO EMAIL-SORT.
   125     RELEASE SORTED.
   126
   127 FIM-ENTRADA SECTION.
   128     CLOSE CADCLI.
   129
   130 ROT-SAIDA SECTION.
   131     PERFORM INICIO-SAIDA.
   132     PERFORM PRINCIPAL-SAIDA UNTIL FIM-ARQ EQUAL "SIM".
   133     PERFORM FIM-SAIDA.
   134
   135 INICIO-SAIDA SECTION.
   136     MOVE "NAO" TO FIM-ARQ.
   137     OPEN OUTPUT RELAT.
   138     PERFORM LE-SAIDA.
   139
   140 LE-SAIDA SECTION.
   141     RETURN ARQORD AT END MOVE "SIM" TO FIM-ARQ.
   142
   143 PRINCIPAL-SAIDA SECTION.
   144     PERFORM LE-SAIDA.
   145     PERFORM IMPRESSAO-SAIDA.
   146
   147
   148 IMPRESSAO-SAIDA SECTION.
   149
   150     IF EST-TMP NOT EQUAL TO EST-SORT
   151         MOVE EST-SORT TO EST-TMP
   152         PERFORM CABECALHO-SAIDA
   153     ELSE IF CID-TMP NOT EQUAL TO CID-SORT
   154         MOVE CID-SORT TO CID-TMP
   155         PERFORM CABECALHO-SAIDA
   156     ELSE IF CT-LIN EQUAL TO 19
   157         PERFORM CABECALHO-SAIDA.
   158     PERFORM DETALHE-SAIDA.
   159
   160
   161 CABECALHO-SAIDA SECTION.
   162     ADD 1 TO CT-PAG.
   163     MOVE CT-PAG TO VAR-PAG.
   164
   165     IF CT-PAG = 1
   166          WRITE REG-REL FROM CAB-01
   167        ELSE WRITE REG-REL FROM CAB-01 AFTER ADVANCING 4 LINE.
   168
   169     MOVE EST-SORT TO ESTADO-DET.
   170     WRITE REG-REL FROM CAB-02 AFTER ADVANCING 2 LINE.
   171
   172     MOVE CID-SORT TO CIDADE-DET.
   173     WRITE REG-REL FROM CAB-03 AFTER ADVANCING 2 LINE.
* Microsoft COBOL Version 4.5        L2.4 revision 002 05-Jun-23 19:01 Page   4
*                                       EX04.CBL
   174
   175     WRITE REG-REL FROM CAB-04 AFTER ADVANCING 2 LINE.
   176
   177     MOVE ZEROES TO CT-LIN.
   178
   179 DETALHE-SAIDA SECTION.
   180     MOVE CPF-SORT TO CPF-DET.
   181     MOVE NOME-SORT TO NOME-DET.
   182     MOVE EMAIL-SORT TO EMAIL-DET.
   183
   184     WRITE REG-REL FROM DETALHE AFTER ADVANCING 1 LINE.
   185     ADD 1 TO CT-LIN.
   186
   187 FIM-SAIDA SECTION.
   188     CLOSE RELAT.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        1756     Code:        1061     Dictionary:        2785
